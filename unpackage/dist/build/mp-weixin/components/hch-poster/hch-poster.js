(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/hch-poster/hch-poster"],{"2db5":function(t,e,n){"use strict";var r=n("7bd1"),i=n.n(r);i.a},"2df6":function(t,e,n){"use strict";n.r(e);var r=n("5a46"),i=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);e["default"]=i.a},"5a46":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(n("a34a")),i=n("2f62");function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n,r,i,a,s){try{var o=t[a](s),c=o.value}catch(l){return void n(l)}o.done?e(c):Promise.resolve(c).then(r,i)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){s(a,r,i,o,c,"next",t)}function c(t){s(a,r,i,o,c,"throw",t)}o(void 0)}))}}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h={data:function(){return{canvasShow:!1,attrs:{curPageUrl:"pages/index/index",name:"姓名",label:"标签",sub:"头衔",contentTitle:"标题",contentText:"内容",marginLR:40,marginTB:40,radius:.01,fillColor:"#ffffff",innerLR:20,innerTB:20,posterRatio:1,posterImgUrl:"",title:"",titleFontSize:18,titleLineHeight:25,posterCodeUrl:"",codeWidth:.2,codeRatio:1,codeRadius:.5,codeMT:20,codeName:"网经社",codeNameMT:20,tips:"长按/扫描识别查看商品",posterBgUrl:"https://www.100ec.cn/Public/home/images/wx_haibao_bg.jpg",codeML:140,desTextMT:70,desTextML:240}}},props:{posterBgFlag:{type:Boolean,default:!0},simpleFlag:{type:Boolean,default:!1},complainFlag:{type:Boolean,default:!1},billType:{type:String,default:"user"}},mounted:function(){this.system=this.getSystem()},computed:l({},(0,i.mapState)(["shareOptions","dsbShareOptions"])),methods:{posterShow:function(){this.canvasShow=!0,Object.assign(this.attrs,this.complainFlag?this.dsbShareOptions:this.shareOptions),this.attrs={kw:this.attrs.kw,curPageUrl:this.attrs.curPageUrl,logo:this.attrs.logo,name:this.attrs.name,label:this.attrs.label,sub:this.attrs.sub,contentTitle:this.attrs.contentTitle,contentText:this.attrs.contentText,marginLR:this.attrs.marginLR*this.systemScale,marginTB:this.attrs.marginTB*this.systemScale,innerLR:this.attrs.innerLR*this.systemScale,innerTB:this.attrs.innerTB*this.systemScale,radius:this.attrs.radius,fillColor:this.attrs.fillColor,posterRatio:this.attrs.posterRatio,posterImgUrl:this.attrs.posterImgUrl,title:this.attrs.title,titleFontSize:this.attrs.titleFontSize*this.systemScale,titleLineHeight:this.attrs.titleLineHeight*this.systemScale,posterCodeUrl:this.attrs.posterCodeUrl,codeWidth:this.attrs.codeWidth*this.systemScale,codeRatio:this.attrs.codeRatio,codeRadius:this.attrs.codeRadius,codeMT:this.attrs.codeMT*this.systemScale,codeName:this.attrs.codeName,codeNameMT:this.attrs.codeNameMT*this.systemScale,tips:this.attrs.tips,posterBgUrl:this.attrs.posterBgUrl,codeML:this.attrs.codeML*this.systemScale,desTextMT:this.attrs.desTextMT*this.systemScale,desTextML:this.attrs.desTextML*this.systemScale},this.complainFlag?this.creatComplainPoster(this.attrs):this.creatPoster(this.attrs)},creatPoster:function(t){var e=this;return o(r.default.mark((function n(){var i,a,s,o,c;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return wx.showLoading({title:"生成海报中..."}),n.next=3,e.getCodeUrl();case 3:return i=wx.createCanvasContext("myCanvas",e),i.draw(),e.roundRect(i,t.marginLR,t.marginTB,e.system.w-2*t.marginLR,e.scale*e.system.w-2*t.marginTB-100,0),n.next=8,e.creatBgImg(i,t);case 8:return a=e.creatTitle(i,t),s=8,1,e.createUserInfo(i,t,a),n.next=14,e.creatImg(i,t,a);case 14:a=n.sent,o=e.createContentTitle(i,t,a),a=o.textY,e.createContentText(i,t,a,s-o.textLine),e.creatCode(i,t,a),e.creatLogo(i,t,a),c=t.marginTB+t.innerTB+.8*(e.system.w-2*t.marginLR-2*t.innerLR)*e.scale+e.system.w*t.codeWidth*t.codeRatio+10,e.creatCodeText(i,t,t.tips,c,10,"#54beff"),wx.hideLoading();case 23:case"end":return n.stop()}}),n)})))()},creatComplainPoster:function(t){var e=this;return o(r.default.mark((function n(){var i,a,s,o,c;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return wx.showLoading({title:"生成海报中..."}),n.next=3,e.getCodeUrl();case 3:return i=wx.createCanvasContext("myCanvas",e),i.draw(),e.roundRect(i,t.marginLR,t.marginTB,e.system.w-2*t.marginLR,e.scale*e.system.w-2*t.marginTB-100,0),n.next=8,e.creatBgImg(i,t);case 8:a=e.creatTitle(i,t)+10,s=8,1,o=e.createContentTitle(i,t,a,"#666"),a=o.textY+10,o=e.createContentText(i,t,a,s-o.textLine,"#666"),e.createContentKw(i,t,o.textY,2,t.fillColor),e.creatCode(i,t,a),e.creatLogo(i,t,a),c=t.marginTB+t.innerTB+.8*(e.system.w-2*t.marginLR-2*t.innerLR)*e.scale+e.system.w*t.codeWidth*t.codeRatio+10,e.creatCodeText(i,t,t.tips,c,10,t.fillColor),wx.hideLoading();case 20:case"end":return n.stop()}}),n)})))()},creatSimplePoster:function(t){var e=this;return o(r.default.mark((function n(){var i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(wx.showLoading({title:"生成海报中..."}),i=wx.createCanvasContext("myCanvas",e),i.draw(),e.roundRect(i,t.marginLR,t.marginTB,e.system.w-2*t.marginLR,e.scale*e.system.w-2*t.marginTB-100,(e.system.w-2*t.marginLR)*t.radius,t.fillColor),!e.posterBgFlag){n.next=7;break}return n.next=7,e.creatBgImg(i,t);case 7:e.creatSimpleCode(i,t,t.marginTB),e.creatVerticalTitle(i,t),wx.hideLoading();case 10:case"end":return n.stop()}}),n)})))()},roundRect:function(t,e,n,r,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#ffffff",o=arguments.length>7?arguments[7]:void 0;t.save(),t.beginPath(),t.arc(e+a,n+a,a,Math.PI,1.5*Math.PI),t.lineTo(e+r-a,n),t.arc(e+r-a,n+a,a,1.5*Math.PI,2*Math.PI),t.lineTo(e+r,n+i-a),t.arc(e+r-a,n+i-a,a,0,.5*Math.PI),t.arc(e+a,n+i-a,a,.5*Math.PI,Math.PI),t.lineTo(e,n+a),t.setFillStyle(s),t.fill(),o&&(t.strokeStyle="#fff",t.lineWidth=3,t.stroke()),t.clip()},getSystem:function(){var t=wx.getSystemInfoSync();return this.scale=667/375,this.systemScale=t.windowWidth/375,{w:t.windowWidth,h:t.windowHeight}},creatBgImg:function(e,n){var r=this;return new Promise((function(i,a){wx.getImageInfo({src:n.posterBgUrl,success:function(t){t.width,r.system.w,n.marginLR;e.drawImage(t.path,n.marginLR,n.marginTB,r.system.w-2*n.marginLR,r.scale*r.system.w-2*n.marginTB-100),e.restore(),e.draw(!0),i()},fail:function(e){console.log("fail -> res",e),t.showToast({title:"海报背景图下载异常",duration:2e3,icon:"none"})}})}))},creatImg:function(e,n,r){var i=this;return new Promise((function(a,s){wx.getImageInfo({src:n.posterImgUrl,success:function(t){e.restore(),e.draw(!0);t.width,i.system.w,n.marginLR,n.innerLR;var s=n.marginLR+n.innerLR,o=r+40,c=60;i.roundRect(e,s,o,c,c/n.posterRatio,(i.system.w-2*n.marginLR)*n.radius,null,!0),e.drawImage(t.path,s,o,c,c/n.posterRatio),e.restore(),e.draw(!0),a(o+c/n.posterRatio)},fail:function(e){console.log("fail -> res",e),t.showToast({title:"海报主图下载异常",duration:2e3,icon:"none"})}})}))},creatTitle:function(t,e){t.restore(),t.save(),t.font="normal bold "+e.titleFontSize+"px sans-serif",t.setFillStyle(e.fillColor);var n=this.drawText(t,e.title,e.marginLR+e.innerLR,2*e.innerLR+e.marginTB,this.system.w-2*e.marginLR-2*e.innerLR,e.titleLineHeight,!0).y;return t.draw(!0),t.font="14px sans-serif",n},creatVerticalTitle:function(t,e){var n=this;t.restore(),t.save(),t.setFontSize(e.titleFontSize),e.title.forEach((function(r,i){n.drawText(t,r,e.marginTB+e.desTextML+20*i,e.marginLR+e.desTextMT,15,e.titleLineHeight)})),t.draw(!0)},drawText:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:375,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0,c=(t.canvas,e.split("")),l="",d=1,h=!1;t.textAlign=s?"center":"left";for(var u=0;u<c.length;u++){var f=new RegExp("\n"),m=f.test(c[u]),g=l;m||(g+=c[u]);var w=t.measureText(g),p=w.width;p>i&&u>0?o&&d==o?(h=!0,u=c.length):(t.fillText(l,n,r),l=c[u],r+=a,d++):l=g}return t.fillText(l+(d>1&&h?"...":""),s?this.system.w/2:n,r),{x:n,y:r,textLine:d}},creatCodeText:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#ffffff";t.setFontSize(i),t.setFillStyle(a),t.textAlign="center",t.fillText(n,this.system.w/2,r)},createContentTitle:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#54beff",i=30,a=25;n=i+n,t.setFontSize(14),t.setFillStyle(r);var s=this.system.w-2*e.marginLR-2*e.innerLR,o=this.drawText(t,e.contentTitle,e.marginLR+e.innerLR,n,s,a,!1),c=(o.textY,o.textLine);return t.draw(!0),n+=c*a,{textY:n,textLine:c}},createContentText:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#54beff",a=0,s=25;n=a+n,t.setFontSize(14),t.setFillStyle(i);var o=this.system.w-2*e.marginLR-2*e.innerLR,c=this.drawText(t,e.contentText,e.marginLR+e.innerLR,n,o,s,!1,r),l=(c.textY,c.textLine);return t.draw(!0),n+=l*s,{textY:n,textLine:l}},createContentKw:function(t,e,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#54beff",s=10,o=25;n=s+n,t.setFontSize(12),t.setFillStyle(a);var c=this.system.w-2*e.marginLR-2*e.innerLR,l=e.marginLR+e.innerLR,d=n,h=0;e.kw.forEach((function(n){if(n){var r=t.measureText(n),a=r.width;h+=a+16,h>=c&&(d+=o,l=e.marginLR+e.innerLR,h=0),i.roundRect(t,l,d-14,a+16,18,3,"#f5f5f5"),t.restore(),t.fillText(n,l+8,d),l+=a+16+10}}))},createUserInfo:function(t,e,n){n+=55;var r=e.marginLR+e.innerLR+70;t.textAlign="left";var i=this.createUserText(t,e,e.name,r,n,16);this.createUserLabel(t,e,this.typeToLabel(e.label),r+i+15,n,12),this.createUserText(t,e,e.sub,r,n+25,12,"#54beff")},createUserText:function(t,e,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:14,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#ffffff";t.setFontSize(a),t.setFillStyle(s);var o=this.system.w-r-e.marginLR-e.innerLR;this.drawText(t,n,r,i,o,18,!1,2),t.draw(!0);var c=t.measureText(n),l=c.width;return l},typeToLabel:function(t){return 0==t?"记者":1==t?"专家":2==t?"公关":void 0},createUserLabel:function(t,e,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:14,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#ffffff";t.setFontSize(a),t.setFillStyle(s);var o=t.measureText(n),c=o.width;this.roundRect(t,r-8,i-14,c+16,18,3,"#5555ff"),t.restore(),t.fillText(n,r,i)},creatTextLine:function(){},creatLogo:function(e,n,r){var i=this;wx.getImageInfo({src:n.logo,success:function(t){e.restore(),e.draw(!0);var r=i.system.w,a=r*n.codeWidth*1.5;i.roundRect(e,(r-r*n.codeWidth)/4*1,n.marginTB+n.innerTB+.7*(r-2*n.marginLR-2*n.innerLR)*i.scale+40,a+20,a/2,r*n.codeWidth*n.codeRatio*.05),e.drawImage(t.path,(r-r*n.codeWidth)/4*1+10,n.marginTB+n.innerTB+.7*(r-2*n.marginLR-2*n.innerLR)*i.scale+50,a,a/3),e.restore(),e.draw(!0)},fail:function(){t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})},creatCode:function(e,n,r){var i=this;wx.getImageInfo({src:n.posterCodeUrl,success:function(t){e.restore(),e.draw(!0);var r=i.system.w;i.roundRect(e,(r-r*n.codeWidth)/4*3,n.marginTB+n.innerTB+.7*(i.system.w-2*n.marginLR-2*n.innerLR)*i.scale+30,i.system.w*n.codeWidth,i.system.w*n.codeWidth*n.codeRatio,i.system.w*n.codeWidth*n.codeRatio*n.codeRadius),e.drawImage(t.path,(r-r*n.codeWidth)/4*3,n.marginTB+n.innerTB+.7*(i.system.w-2*n.marginLR-2*n.innerLR)*i.scale+30,i.system.w*n.codeWidth,i.system.w*n.codeWidth*n.codeRatio),e.restore(),e.draw(!0)},fail:function(){t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})},creatSimpleCode:function(e,n){var r=this;wx.getImageInfo({src:n.posterCodeUrl,success:function(t){e.restore(),e.draw(!0),r.roundRect(e,n.marginLR+n.codeML,n.marginTB+n.codeMT,r.system.w*n.codeWidth,r.system.w*n.codeWidth*n.codeRatio,r.system.w*n.codeWidth*n.codeRatio*n.codeRadius),e.drawImage(t.path,n.marginLR+n.codeML,n.marginTB+n.codeMT,r.system.w*n.codeWidth,r.system.w*n.codeWidth*n.codeRatio),e.restore(),e.draw(!0)},fail:function(){t.showToast({title:"海报生成失败",duration:2e3,icon:"none"})}})},handleSaveCanvasImage:function(){var e=this.attrs;wx.showLoading({title:"保存中..."});var n=this;t.canvasToTempFilePath({x:e.marginLR+1,y:e.marginTB+1,width:this.system.w-2*e.marginLR-2,height:this.scale*this.system.w-2*e.marginTB-100-2,destWidth:4*(this.system.w-2*e.marginLR),destHeight:4*(this.scale*this.system.w-2*e.marginTB-100),canvasId:"myCanvas",fileType:"jpg",success:function(e){t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){wx.hideLoading(),t.showToast({title:"图片保存成功，可以去分享啦~",duration:2e3,icon:"none"}),n.$https.get("/Home/Jzbxcx/share",{params:{url:getCurrentPages()[getCurrentPages().length-1].$page.fullPath}}),n.handleCanvasCancel()},fail:function(){t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}})},fail:function(e){console.log("fail -> res",e),t.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"}),wx.hideLoading()}},this)},handleCanvasCancel:function(){this.canvasShow=!1},toJSON:function(){},getCodeUrl:function(){var t=this;return o(r.default.mark((function e(){var n;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$https.get("/Home/Jzbxcx/get_xcx_code",{params:{url:t.attrs.curPageUrl}});case 2:n=e.sent,1==n.data.code&&t.$set(t.attrs,"posterCodeUrl",n.data.ewm);case 4:case"end":return e.stop()}}),e)})))()}}};e.default=h}).call(this,n("543d")["default"])},"7bd1":function(t,e,n){},d885:function(t,e,n){"use strict";var r;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r}));var i=function(){var t=this,e=t.$createElement;t._self._c},a=[]},f4c8:function(t,e,n){"use strict";n.r(e);var r=n("d885"),i=n("2df6");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("2db5");var s,o=n("f0c5"),c=Object(o["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],s);e["default"]=c.exports}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/hch-poster/hch-poster-create-component',
    {
        'components/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("f4c8"))
        })
    },
    [['components/hch-poster/hch-poster-create-component']]
]);
